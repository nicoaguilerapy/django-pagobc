{% extends 'core/base.html' %}

{% block title1 %}
    Clientes
{% endblock title1 %}
{% block title2 %}
Cliente
{% endblock title2 %}
    
{% block content %}

<div class="container">
    <div class="row">
        <form method="POST" >
            {% csrf_token %}
            <div class="form-group mb-0">
                <label for="type_document" class="form-label mt-15">Tipo de Documento</label>
                <select class="form-control" name="type_document" id="type_document">
                    <option value="CI" selected>CI</option>
                    <option value="RU">RUC</option>
                    <option value="PA">PASAPORTE</option>
                    <option value="OT">OTROS</option>
                </select>
            </div>
            <div class="form-group">
                <label for="">Documento Nº:</label>
                <input type="text" name="document" placeholder="Ingrese el Documento" class="form-control" id="client_document">
            </div>
            <div class="form-group" id="input_business_name">
                <label for="">Razón Social:</label>
                <input type="text" name="business_name" placeholder="Ingrese la Razón Social" class="form-control" id="client_business_name">
            </div>
            <div class="form-group">
                <label for="">Nombre:</label>
                <input type="text" name="first_name" placeholder="Ingrese el Nombre" class="form-control" id="client_first_name">
            </div>
            <div class="form-group">
                <label for="">Apellido:</label>
                <input type="text" name="last_name" placeholder="Ingrese el Apellido" class="form-control" id="client_last_name">
            </div>
            <div class="form-group mb-0">
                <label for="region" class="form-label mt-15">Departamento</label>
                <select class="form-control" name="region" id="id_region">
                    <option value="" selected>-----------</option>
                </select>
            </div>
            <div class="form-group">
                <label for="city" class="form-label mt-15">Ciudad</label>
                <select class="form-control" name="city" id="id_city">
                    <option value="" selected>-----------</option>
                </select>
            </div>

            <div class="form-group">
                <label for="">Correo Electronico:</label>
                <input type="email" name="email" placeholder="Ingrese el Correo Electronico" class="form-control" id="client_email">
            </div>
            <div class="form-group">
                <label for="">Número de Contacto:</label>
                <input type="text" name="phone1" placeholder="Ingrese la Número de Contacto" class="form-control" id="client_phone1">
            </div>
            <div class="form-group">
                <label for="">Número de Contacto Auxiliar (Opcional):</label>
                <input type="text" name="phone2" placeholder="Ingrese la Número de Contacto" class="form-control" id="client_phone2">
            </div>
            {% if not client_obj %}
            <div class="form-group">
                <input type="checkbox" name="visibility" id="client_visibility" 
                {% if client_obj.visibility %} checked {% endif %} >
                <label class="form-check-label" for="visibility">Activado</label>
            </div>
            {% endif %}  

            
        <div class="dropdown-divider"></div>
        
        {% if client_obj %}
        <button type="submit" class="btn btn-success"><span class="fa fa-save"></span>Guardar</button>
        {% else %}
        <button type="submit" class="btn btn-success"><span class="fa fa-save"></span> Nuevo</button>
        {% endif %}
        <button type="button" data-dismiss="modal" class="btn btn-danger">Cerrar</button>

        </form>
    </div>
</div>

{% endblock content %}


{% block extra_script %}
<script type="text/javascript">
    var global_departamentos = null;
    var global_ciudades = null;

    
    $("#id_region").on('change', function(){
        setCiudades();
    });

    $("#type_document").on('change', function(){
        if($('#type_document').val()=='RU'){
            $("#input_business_name").show();
        }else{
            $("#input_business_name").hide();
        }
    });

$(document).ready(function(){
    var local_values = getValuesCheck();
    global_departamentos = JSON.parse(JSON.stringify(local_values.departamentos));
    global_ciudades = JSON.parse(JSON.stringify(local_values.ciudades));

    $("#input_business_name").hide()

    setDepartamentos()

    

});

function getValuesCheck() {
	return JSON.parse($.ajax({
        type: 'POST',
		    global: false,
		    async: false,
        url: "/profiles/ajax/address/",
        success:function(data){
			return data; 
        },
        error:function(){   
        }
        }).responseText);
}


function setDepartamentos() {
  var count = Object.keys(global_departamentos).length;

  for(let i = 0; i < count; i ++){
    var text = '<option value="'+global_departamentos[i].id+'">'+global_departamentos[i].nombre+'</option>'
    $('#id_region').append(text);
  }

  {% if client_obj.region %}
  var selId = document.getElementById("id_region")
  selId.value = {{client_obj.region.id}}
  {% endif %}

  {% if client_obj.city %}
  setCiudades()
  var selId2 = document.getElementById("id_city")
  selId2.value = {{client_obj.city.id}}
  {% endif %}
}

function setCiudades() {
  var select = document.getElementById('id_region');
  var count = Object.keys(global_ciudades).length;

  $('#id_city').empty().append('<option selected="selected" value="-1">Seleccionar un Departamento</option>');

  for(let i = 0; i < count; i ++){
    if(global_ciudades[i].cod_departamento == select.value){
      var text = '<option value="'+global_ciudades[i].id+'">'+global_ciudades[i].nombre+'</option>'
      $('#id_city').append(text);
    }
   
  }

}

</script>
{% endblock extra_script %}
    